\newcommand{\bitscorevec}{\boldsymbol{b}}
\newcommand{\genscoreRVCorrected}{G'}
\newcommand{\bitscoreRV}{B}
\newcommand{\syndromeRV}{S}
\newcommand{\generatorscorevec}{\boldsymbol{g}}
\newcommand{\generatorscoreRV}{G}
\newcommand{\synd}{\boldsymbol{\boldsymbol{\sigma_X}}}
\newcommand{\NTQ}{{\Delta_{\text{stablizer}}}}
\newcommand{\NTS}{{\Delta_{\text{bit}}}}
\newcommand{\errorvec}{\boldsymbol{\boldsymbol{e}}}

% TODO: say we are working with (a, b) regular graphs. 
% TODO: say we are working with a $(\gamma, \delta)$ expander code

The following section assumes that we are working with syndrome $\synd$,
a generator matrix $H_Z$, and parity check matrix $H_X$.
The analysis is the same for a syndrome, $\boldsymbol{\sigma_Z}$, generator matrix $H_X$, and
parity check matrix $H_Z$.

\subsection*{Notation}
Given a vector $\boldsymbol{v}$, define $v_i$ to be the value of the $i$th row of $\boldsymbol{v}$.

\subsection*{Definitions}
Let $\NTQ$ equal to the degree of a stabilizer vertex. Note that due to the hypergraph's construction,
all stabilizers have the same constant degree. 
Let $\NTS$ equal to the degree of a qubit vertex. As with the stabilizers, all qubits have the same constant degree.

Given a syndrome, $\synd$, define a ``bit-score vector", $\bitscorevec = H_X^T \synd$ where
$\bitscorevec \in \Z^{\NQubits}$. 
Then, define a ``generator-score vector" as $\generatorscorevec = H_z \bitscorevec $ where
$\generatorscorevec \in \Z^{\NStables}$. 
Moreover, assume that for error $e \in \F_2^{\NQubits}$, $\Pr\mleft[e_i = 1\mright] = p$ for all $i \in [\NQubits]$ (i.e.\ 
the error is modeled as independent). Let $q = 1-p$.
Let $s_1, s_2, ..., s_{\NStables}$ denote the set of stabilizer vertices.
Let $N_i = \sum_{j \in \Gamma(s_i)} \errorvec_j$ where $N_i \in \Z$. $N_i$ can be thought of
as the number of qubits with an error in the neighborhood of $N_i$.

Then, let random variable $\bitscoreRV_i \in \Z$ correspond to $\bitscorevec_i$ and random variable $\generatorscoreRV_i \in \Z$
correspond to $\generatorscorevec_i$. Also, let random variable $\syndromeRV_i \in F_2$ correspond  to $\synd_i$.

\newcommand{\SPr}{\half - \half\mleft(1-2p\mright)^\NTQ}
\begin{align*}
	\Pr[S_i = 1] = \Pr\mleft[\texttt{$N_i$ is odd}\mright] = \SPr
\end{align*}

So,
$$
	\syndromeRV_i \sim \texttt{Bernoulli}\mleft(\SPr\mright).
$$

% TODO: NEXT STEP: TRELLO / WEEK IN ADVANCE
Then,
% TODO: better like neighbourhood thingy
$$
	\bitscoreRV_i = \sum_{\texttt{Stabilizer $j$} \; \in \; \Gamma(\texttt{Bit $i$})} \syndromeRV_j
$$
So, 
$$
	\bitscoreRV_i \sim \texttt{Binom}(\NTS, \SPr).
$$

And then,
$$
	\generatorscoreRV_k =
		\sum_{\texttt{Bit $i$} \; \in \; \Gamma(\texttt{generator } k)}\;
			\sum_{\texttt{Stabilizer } j \; \in \; \Gamma(\texttt{Bit } i)}
				\syndromeRV_j
$$

So then,
$$
	\generatorscoreRV_k \sim \texttt{Binom}(\NTS \NTQ, \SPr).
$$

The pfm algorithm (Algorithm \ref{alg:pfm}) on line \ref{alg:pfm:line:assign}
gets the $K$ generators, indexed by $g_1, g_2, ..., g_K$, with the top values
of $\generatorscorevec_i$ for $i \in [\NStables]$. WLOG, assume
$\generatorscorevec_{g_1} \geq \generatorscorevec_{g_2} \geq ... \geq \generatorscorevec_{g_K}$.
Then, we can think of $\E[\generatorscorevec_{g_i}]$ as the expected value of the $i$ 
top sample from $\NStables$ samples from the distribution defining $\generatorscoreRV_i$.

Then, let $\genscoreRVCorrected$ be the normalized version of $\generatorscoreRV$ where
$$
	\genscoreRVCorrected = \frac{\generatorscoreRV - \mu}{\sigma}
$$
where $\mu = \NTS \NTQ \SPr$ and $\sigma = \sqrt{\NTS \NTQ \SPr (1 - \SPr)}$.

We then know that by the BLANK BLANK BOUND TODO:,
$$
	|\Pr[\genscoreRVCorrected \geq u] - \Pr[Z \geq u]| \leq O(\beta)
$$
where
$$
	\beta = \sum_{i=1}^{\NTS \NTQ} \E\mleft[\mleft|\frac{1 - \mu}{\sigma}\mright|^3\mright]
	= O\mleft(\frac{1}{\sqrt{\NTS \NTQ}\mright)
$$


% where $\genscoreRVCorrected$ is a random variable and $\genscoreRVCorrected \in Z$.

% Note that due to the expander graph property, generator $k$ has at least 
% $(1 - \delta)\NTQ$ unique stabilizer vertices in its neighborhood.


% STEPS:
% \begin{align*}
% 	\Pr\mleft[\synd_i = 0\; \middle|\; S_i > 0\mright] &=
% 		\Pr[\texttt{$S_i$ is even}] - \Pr[S_i = 0] \\
% 		&= \half + \half \mleft( 1 - 2p\mright)^\NTQ - q^\NTQ
% \end{align*}

% Then, assuming that $p < 0.5$, $\Pr\mleft[\synd_i = 0\; \middle|\; S_i > 0\mright] < \half$
